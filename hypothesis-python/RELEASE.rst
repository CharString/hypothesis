RELEASE_TYPE: patch

Refactor some internal code related to patches to make it easier to test.
