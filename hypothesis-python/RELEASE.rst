RELEASE_TYPE: patch

This patch refactors some internals to prepare for future work using our IR (:issue:`3921`).
