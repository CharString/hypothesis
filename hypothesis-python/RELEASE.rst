RELEASE_TYPE: patch

his patch refactors some internals to prepare for future work using our IR (:issue:`3921`).
